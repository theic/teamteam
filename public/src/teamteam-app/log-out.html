<link rel="import" href="/components/polymer/polymer.html">
<link rel="import" href="/components/paper-button/paper-button.html">
<link rel="import" href="app-data.html">

<link rel="import" href="/components/iron-ajax/iron-ajax.html">

<dom-module id="log-out">
    <template>
        <style>
            :host {
                margin: 0;
                padding: 0;
            }
        </style>

        <app-data key="userData" data="{{storedUser}}"></app-data>

        <iron-ajax
                id="registerLogoutAjax"
                method="post"
                content-type="application/json"
                handle-as="text"
                on-response="handleUserResponse"
                on-error="handleUserError"></iron-ajax>

        <paper-button on-tap="postLogout">Выйти</paper-button>

    </template>

    <script>
        (function () {
            Polymer({
                is: 'log-out',
                properties: {
                    storedUser: Object,
                    error: String
                },
                postLogout: function () {
                    this.$.registerLogoutAjax.url = 'http://localhost:3000/logout';
                    this.$.registerLogoutAjax.body = '';
                    this.$.registerLogoutAjax.generateRequest();
                    // remove user data
                    this.storedUser = null;

                    this.set('route.path', '/home-page');
                },
                handleUserResponse: function (event) {
                    console.log(event.detail.response);
                },
                handleUserError: function (event) {
                    this.error = event.detail.request.xhr.response;
                }
            });
        }());
    </script>
</dom-module>