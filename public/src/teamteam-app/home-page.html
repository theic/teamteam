<link rel="import" href="/components/polymer/polymer.html">
<link rel="import" href="/components/iron-ajax/iron-ajax.html">
<link rel="import" href="/components/paper-button/paper-button.html">
<link rel="import" href="shared-styles.html">

<link rel="import" href="/components/iron-localstorage/iron-localstorage.html">
<link rel="import" href="/src/teamteam-app/app-data.html">

<dom-module id="home-page">
    <template>
        <style include="shared-styles">
            :host {
                display: block;
                padding: 10px;
                background: #EF5458;
                height: 1000px;
            }
        </style>

        <iron-localstorage
                name="user-storage"
                value="{{storedUser}}"
                on-iron-localstorage-load="initStoredUser"></iron-localstorage>

        <app-data key="userData" data="{{storedUser}}"></app-data>

        <h1>Hello...</h1>

        <iron-ajax
                id="getProtected"
                auto
                url="http://localhost:3000/content"
                method="post"
                handle-as="text"
                last-response="{{msg}}"></iron-ajax>

            <p>[[msg]]</p>

    </template>

    <script>
        (function() {
            Polymer({
                is: 'home-page',
                properties: {
                    storedUser: Object
                },
                initStoredUser: function() {
                    // if entering site on the secret quotes page, verify if logged in and if so, preload a secret quote
                    if (this.storedUser.loggedin) {
                        this.getData();
                    }
                },
                getData: function() {
                    this.$.getProtected.headers['sid'] = this.storedUser.sessionid;
                    this.$.getProtected.generateRequest();
                }
            });
        }());
    </script>
</dom-module>