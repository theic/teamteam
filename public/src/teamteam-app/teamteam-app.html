<link rel="import" href="/components/polymer/polymer.html">

<link rel="import" href="/components/app-route/app-location.html">
<link rel="import" href="/components/app-route/app-route.html">
<link rel="import" href="/components/iron-pages/iron-pages.html">
<link rel="import" href="/components/iron-selector/iron-selector.html">
<link rel="import" href="/components/iron-localstorage/iron-localstorage.html">
<link rel="import" href="/src/teamteam-app/app-data.html">

<link rel="import" href="/components/app-layout/app-layout.html">
<link rel="import" href="/components/app-layout/app-scroll-effects/app-scroll-effects.html">

<link rel="import" href="/components/paper-input/paper-input.html">
<link rel="import" href="/components/paper-button/paper-button.html">
<link rel="import" href="/components/paper-tooltip/paper-tooltip.html">
<link rel="import" href="/components/paper-card/paper-card.html">

<link rel="import" href="/components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="/src/teamteam-app/login-form.html">
<link rel="import" href="/src/teamteam-app/log-out.html">

<link rel="import" href="/components/iron-ajax/iron-ajax.html">

<!--<link rel="import" href="../../bower_components/polymer/lib/elements/dom-if.html">-->
<!--<link rel="import" href="../../bower_components/polymer/lib/elements/dom-repeat.html">-->

<dom-module id="teamteam-app">
    <template>
        <style>

            .dark-primary-color {
                background: #455A64;
            }

            .default-primary-color {
                background: #607D8B;
            }

            .light-primary-color {
                background: #CFD8DC;
            }

            .text-primary-color {
                color: #FFFFFF;
            }

            .accent-color {
                background: #03A9F4;
            }

            .primary-text-color {
                color: #212121;
            }

            .secondary-text-color {
                color: #757575;
            }

            .divider-color {
                border-color: #BDBDBD;
            }

            app-header-layout {
                z-index: 1;
            }

            app-toolbar {
                /* Toolbar is the main header, so give it some color */
                background-color: #607D8B;
                font-family: 'Roboto', Helvetica, sans-serif;
                color: white;
                --app-toolbar-font-size: 24px;
            }

            paper-input-container {
                font-family: 'Roboto', Helvetica, sans-serif;
                --paper-input-container-color: white;
                --paper-input-container-focus-color: white;
                --paper-input-container-input-color: white;
                margin-right: 20px;
            }

            gold-email-input {
                font-family: 'Roboto', Helvetica, sans-serif;
                --paper-input-container-color: white;
                --paper-input-container-focus-color: white;
                --paper-input-container-input-color: white;
                margin-right: 20px;
            }

            .newTaskBtn {
                font-size: 16px;
                display: inline-block;
                color: #757575;
                --paper-icon-button-ink-color: white;
                margin-top: 50px;
                margin-bottom: 50px;
            }

            paper-tooltip {
                --paper-tooltip-background: white;
                --paper-tooltip-text-color: #757575;
            }

            paper-button {
                font-size: 16px;
            }
        </style>

        <iron-localstorage name="user-storage" value="{{storedUser}}"></iron-localstorage>
        <app-data key="userData" data="{{storedUser}}"></app-data>

        <app-location route="{{route}}"></app-location>
        <app-route
                route="{{route}}"
                pattern="/:page"
                data="{{routeData}}"
                tail="{{subroute}}"></app-route>

        <app-header-layout>
            <app-header reveals condenses effects="waterfall">

                <app-toolbar>
                <div main-title></div>
                    <iron-selector selected="[[page]]" attr-for-selected="name" role="navigation">
                        <div name="home-page">
                            <a href="/home-page">Домой</a>
                        </div>
                        <div name="profile-page" hidden$="[[!storedUser.loggedin]]">
                            <a href="/profile-page">Профиль</a>
                        </div>
                    </iron-selector>
                </app-toolbar>

                <app-toolbar sticky>

                    <login-form hidden$="[[storedUser.loggedin]]"></login-form>

                    <div hidden$="[[!storedUser.loggedin]]">
                        <span class="greeting">Hi [[storedUser.name]]!</span>
                        <log-out stored-user="{{storedUser}}"></log-out>
                    </div>
                </app-toolbar>

            </app-header>
        </app-header-layout>

        <iron-pages
                selected="[[page]]"
                attr-for-selected="name"
                fallback-selection="not-found"
                role="main">
            <home-page name="home-page"></home-page>
            <!--<register-login name="register-login"></register-login>-->
            <profile-page name="profile-page"></profile-page>
            <not-found name="not-found"></not-found>
        </iron-pages>
        <!--<h2>Hello [[prop1]]!</h2>-->
    </template>

    <script>
        (function() {
            Polymer({
                is: 'teamteam-app',
                properties: {
                    page: {
                        type: String,
                        reflectToAttribute: true,
                        observer: '_pageChanged'
                    },
                    storedUser: Object
                },
                observers: [
                    '_routePageChanged(routeData.page)'
                ],
                _routePageChanged: function (page) {
                    this.page = page || 'home-page';
                },
                _pageChanged: function (page) {
                    // Load page import on demand. Show 404 page if fails
                    var resolvedPageUrl = this.resolveUrl(page + '.html');
                    this.importHref(resolvedPageUrl, null, this._showPage404, true);
                },

                _showPage404: function () {
                    this.page = 'not-found';
                }
            });
        }());
    </script>
</dom-module>
